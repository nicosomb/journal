{% extends "base.njk" %}

{% block html_lang %}fr{% endblock %}

{% block head %}
{{ super() }}
{% if summary %}
<meta name="description" content="{{ summary | striptags | truncate(150) }}" />
{% endif %}
{% endblock head %}

{% block title %}{{ title | striptags }} | {{ site.siteName }}{% endblock title %}

{% block content %}

<main>
    <section>
      <p>{{ date | strftime('%d-%m-%Y') }}
      {% if tags and tags | length > 0 %}
      — tags : <span class="article-tags">
        {% for tag in tags %}
        <a href="/tags/{{ tag | slugify }}/" class="tag">{{ tag }}</a>{% if not loop.last %}, {% endif %}
        {% endfor %}
      </span>
      {% endif %}
      {% set reactionCount = webmentions | countWebmentions(page.url, site.siteUrl) %}
      {% if reactionCount > 0 %}
      — <a href="#webmentions">{{ reactionCount }} {% if reactionCount > 1 %}réactions{% else %}réaction{% endif %}</a>
      {% else %}
      — 0 réaction
      {% endif %}
      </p>
    </section>
    <article>
      <h1>{{ title }}</h1>

      {{ content | safe }}

      <div class="separator"></div>

      {% include "webmentions.njk" %}

      <p class="article-meta">
        {% if site.webmentionDomain %}
        Réagissez via webmention en citant ce lien : <code>{{ site.siteUrl }}{{ page.url | replace('/index.html', '') }}</code> ou <a href="mailto:nicolas@loeuillet.org?subject={{ title | striptags | urlencode }}">contactez-moi par mail</a>.
        {% endif %}
        {% if page.inputPath %}
        <br /><a href="{{ site.githubRepo }}/blob/{{ site.githubBranch }}/{{ page.inputPath | cleanPath }}">Vous avez trouvé une coquille ? Proposez une correction</a>
        {% endif %}
      </p>

      <div class="separator"></div>

      {% set currentIndex = -1 %}
      {% for post in collections.billets %}
        {% if post.url == page.url %}
          {% set currentIndex = loop.index0 %}
        {% endif %}
      {% endfor %}
      
      {% if currentIndex >= 0 %}
        {% set prevPost = collections.billets[currentIndex + 1] %}
        {% set nextPost = collections.billets[currentIndex - 1] %}
        {% if prevPost or nextPost %}
        <nav class="article-navigation">
          <div class="article-nav-container">
            <div class="article-nav-prev">
              {% if prevPost %}
              <a href="{{ prevPost.url }}">← {{ prevPost.data.title }}</a>
              {% endif %}
            </div>
            <div class="article-nav-next">
              {% if nextPost %}
              <a href="{{ nextPost.url }}">{{ nextPost.data.title }} →</a>
              {% endif %}
            </div>
          </div>
        </nav>
        {% endif %}
      {% endif %}

      <div class="separator"></div>

    </article>
</main>

{% endblock content %}
